<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Principale</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #6b7280;
            --background-color: #f3f4f6;
            --surface-color: #ffffff;
            --border-color: #e5e7eb;
            --text-color: #1f2937;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            width: 250px;
            background-color: var(--surface-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 1.5rem 0;
        }
        .sidebar h1 {
            font-size: 1.5rem;
            font-weight: 700;
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }
        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        .nav-item a {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            border-left: 3px solid transparent;
        }
        .nav-item a:hover {
            background-color: #f9fafb;
        }
        .nav-item a.active {
            color: var(--primary-color);
            background-color: #eff6ff;
            border-left-color: var(--primary-color);
        }
        .nav-item svg {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
        }
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 2rem;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        #logout-btn {
            background: none;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: left;
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h1>Mon App</h1>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" data-page="home">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
                    Home
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-page="messages">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" /></svg>
                    Messages
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-page="groupes">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m-7.5-2.962a3.75 3.75 0 1 0-7.5 0 3.75 3.75 0 0 0 7.5 0ZM10.5 12a7.5 7.5 0 1 1 15 0 7.5 7.5 0 0 1-15 0Z" /></svg>
                    Groupes
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-page="publier">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
                    Publier
                </a>
            </li>
             <li class="nav-item">
                <a href="#" class="nav-link" data-page="notifications">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" /></svg>
                    Notifications
                </a>
            </li>
        </ul>
        <div class="nav-item" style="padding: 0 1.5rem;">
            <a href="#" id="logout-btn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" /></svg>
                Déconnexion
            </a>
        </div>
    </aside>

    <main class="main-content" id="main-content-area">
        </main>

    <script type="module">
        const supabaseUrl = 'https://rrcbprbxgonzsqldhfil.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyY2JwcmJ4Z29uenNxbGRoZmlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1MzY1NjUsImV4cCI6MjA3NDExMjU2NX0.-C7VtLJA7ZLByprNBsMKSIKnH7HubPzgpIXyKEGYwrA';
        const { createClient } = supabase.supabase;
        const _supabase = createClient(supabaseUrl, supabaseKey);

        const mainContentArea = document.getElementById('main-content-area');
        const navLinks = document.querySelectorAll('.nav-link');

        // Fonction pour vérifier la session utilisateur
        async function checkUserSession() {
            const { data: { session } } = await _supabase.auth.getSession();
            if (!session) {
                window.location.href = 'auth.html';
            }
        }

        // Fonction pour charger le contenu des pages
        async function loadPageContent(pageName) {
            try {
                const response = await fetch(`./pages/${pageName}.html`);
                if (!response.ok) throw new Error(`Could not load ${pageName}.html`);
                const content = await response.text();
                return { name: pageName, content: content };
            } catch (error) {
                console.error(error);
                return { name: pageName, content: `<p>Erreur de chargement du contenu.</p>` };
            }
        }
        
        // Fonction pour changer de page
        function switchPage(pageName) {
            // Mettre à jour la classe active sur les liens de navigation
            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.page === pageName);
            });
            // Afficher la page correspondante
            document.querySelectorAll('.page').forEach(page => {
                page.classList.toggle('active', page.id === `page-${pageName}`);
            });
        }
        
        // Initialisation de l'application
        async function initializeApp() {
            await checkUserSession();
            
            const pagesToLoad = ['home', 'messages', 'groupes', 'publier', 'notifications'];
            const pagePromises = pagesToLoad.map(loadPageContent);
            const loadedPages = await Promise.all(pagePromises);
            
            loadedPages.forEach(page => {
                const pageContainer = document.createElement('div');
                pageContainer.id = `page-${page.name}`;
                pageContainer.classList.add('page');
                pageContainer.innerHTML = page.content;
                mainContentArea.appendChild(pageContainer);
            });
            
            // Afficher la page d'accueil par défaut
            switchPage('home');
        }

        // Gestion des clics sur la navigation
        document.querySelector('.nav-menu').addEventListener('click', (e) => {
            const link = e.target.closest('.nav-link');
            if (link) {
                e.preventDefault();
                const pageName = link.dataset.page;
                switchPage(pageName);
            }
        });

        // Gestion de la déconnexion
        document.getElementById('logout-btn').addEventListener('click', async (e) => {
            e.preventDefault();
            const { error } = await _supabase.auth.signOut();
            if (error) {
                console.error('Erreur de déconnexion:', error);
            } else {
                window.location.href = 'auth.html';
            }
        });

        // Lancer l'application
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
