<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>World Web- Main</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<style>
  :root{
    --bg:#f0f2f5; --card:#fff; --accent:#2563eb; --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial,"Noto Sans",sans-serif;background:var(--bg);color:#111}
  header{
    position:fixed;top:0;left:0;right:0;height:64px;background:var(--card);
    box-shadow:0 4px 18px rgba(2,6,23,0.08);display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:2000;
  }
  header .brand{display:flex;align-items:center;gap:12px}
  header h1{font-size:18px;margin:0}
  header nav{display:flex;gap:8px;align-items:center}
  header button{background:transparent;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-size:15px}
  header button.active{background:rgba(37,99,235,0.12);color:var(--accent)}
  #app{padding:84px 16px 32px;max-width:980px;margin:0 auto;min-height:calc(100vh - 100px)}
  .pageContent{opacity:0;transform:translateY(10px) rotateX(4deg);animation:enter 380ms ease forwards}
  @keyframes enter{to{opacity:1;transform:none}}

  .card{background:var(--card);border-radius:10px;padding:14px;margin-bottom:14px;box-shadow:0 1px 6px rgba(2,6,23,0.04)}
  .muted{color:var(--muted);font-size:13px}

  .row{display:flex;gap:8px;align-items:center}
  input,textarea,select,button{font-family:inherit}
  .btn{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
  .hidden{display:none}
  .media-thumb{max-width:120px;border-radius:8px;display:block;margin-top:8px}
  .search{display:flex;gap:8px;align-items:center}
  .search input{padding:8px;border-radius:8px;border:1px solid #e5e7eb;width:260px}

  /* responsive */
  @media (max-width:640px){
    header{
      padding:10px;
      height:auto; 
      align-items: center;
    }
    header nav {
      flex-wrap: wrap; 
      justify-content: flex-end; 
    }
    .search input{width:140px}

    /* --- LA SOLUTION EST ICI --- */
    /* On augmente le padding du haut pour compenser la hauteur du header qui a grandi */
    #app {
      padding-top: 130px; 
    }
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="https://api.iconify.design/ant-design:notification-filled.svg?color=%232563eb" style="width:28px;height:28px" alt="logo">
    <h1>FiK</h1>
    <div class="muted" style="margin-left:6px;font-size:13px">communaut√©</div>
  </div>

  <nav id="navButtons">
    <button id="btn-home" onclick="affichePage('home')">üè† Home</button>
    <button id="btn-messages" onclick="affichePage('messages')">üí¨ Messages</button>
    <button id="btn-notifications" onclick="affichePage('notifications')">üîî Notifications</button>
    <button id="btn-groupes" onclick="affichePage('groupes')">üë• Groupes</button>
    <button id="btn-publier" onclick="affichePage('publier')">‚úçÔ∏è Publier</button>
    <button class="btn ghost" onclick="location.href='auth.html'">Se d√©connecter</button>
  </nav>
</header>

<main id="app">Chargement...</main>

<script>
const { createClient } = supabase;
const SUPA_URL = 'https://rrcbprbxgonzsqldhfil.supabase.co';
const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyY2JwcmJ4Z29uenNxbGRoZmlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1MzY1NjUsImV4cCI6MjA3NDExMjU2NX0.-C7VtLJA7ZLByprNBsMKSIKnH7HubPzgpIXyKEGYwrA';
const supabaseClient = createClient(SUPA_URL, SUPA_KEY);

const PAGE_NAMES = ['home','messages','notifications','groupes','publier'];
const pages = {};
async function preloadPages(){
  for(const name of PAGE_NAMES){
    try{
      const res = await fetch(`pages/${name}.html`);
      if(!res.ok) {
        pages[name] = `<div class="card">Erreur : page "${name}" introuvable.</div>`;
        continue;
      }
      pages[name] = await res.text();
    } catch(e){
      pages[name] = `<div class="card">Erreur fetch ${e.message}</div>`;
    }
  }
  affichePage('home');
}
preloadPages();

function runInlineScripts(container){
  const scripts = container.querySelectorAll('script');
  scripts.forEach(s => {
    try{
      const code = s.textContent;
      const fn = new Function(code);
      fn();
    }catch(err){
      console.error('Script error:', err);
    }
  });
}

function setActiveButton(name){
  PAGE_NAMES.forEach(n=>{
    const b = document.getElementById('btn-'+n);
    if(b) b.classList.toggle('active', n===name);
  });
}
function affichePage(pageName){
  const app = document.getElementById('app');
  setActiveButton(pageName);
  const raw = pages[pageName] || `<div class="card">Page non trouv√©e</div>`;
  app.innerHTML = `<div class="pageContent" id="page-${pageName}">${raw}</div>`;
  requestAnimationFrame(()=> {
    const container = document.getElementById('page-'+pageName);
    runInlineScripts(container);
  });
}

async function currentUser(){
  const { data } = await supabaseClient.auth.getUser();
  return data?.user || null;
}
</script>

</body>
</html>
